import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as A}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getDatabase as k,onValue as w,ref as h,set as P}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";import{getAuth as O,onAuthStateChanged as $,signInWithEmailAndPassword as q,signOut as R}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";const j={apiKey:"AIzaSyCjLzq8QNQqhGOpTJy3tzwuQrovMm6Vdi4",authDomain:"unlock-the-lab-workshop.firebaseapp.com",databaseURL:"https://unlock-the-lab-workshop-default-rtdb.europe-west1.firebasedatabase.app",projectId:"unlock-the-lab-workshop",storageBucket:"unlock-the-lab-workshop.firebasestorage.app",messagingSenderId:"604889899913",appId:"1:604889899913:web:d46afe88111e8bcb7d3758",measurementId:"G-VEVYY65K1M"},B=A(j),U=k(B),v=O(B),r=["STUDY-101","STUDY-102","STUDY-103","STUDY-104","STUDY-105","STUDY-106","STUDY-107","STUDY-108","STUDY-109","STUDY-110","STUDY-111","STUDY-112","STUDY-113","STUDY-114","STUDY-115","STUDY-116","STUDY-117","STUDY-118","STUDY-119","STUDY-120","STUDY-121","STUDY-122","STUDY-123"],L={"STUDY-101":"low","STUDY-102":"medium","STUDY-103":"high","STUDY-104":"low","STUDY-105":"medium","STUDY-106":"medium","STUDY-107":"low","STUDY-108":"high","STUDY-109":"medium","STUDY-110":"high","STUDY-111":"low","STUDY-112":"low","STUDY-113":"high","STUDY-114":"medium","STUDY-115":"low","STUDY-116":"medium","STUDY-117":"low","STUDY-118":"medium","STUDY-119":"high","STUDY-120":"low","STUDY-121":"medium","STUDY-122":"high","STUDY-123":"low"},M={"STUDY-101":1,"STUDY-102":5,"STUDY-103":6,"STUDY-104":1,"STUDY-105":5,"STUDY-106":4,"STUDY-107":2,"STUDY-108":7,"STUDY-109":4,"STUDY-110":6,"STUDY-111":2,"STUDY-112":1,"STUDY-113":6,"STUDY-114":5,"STUDY-115":3,"STUDY-116":5,"STUDY-117":1,"STUDY-118":4,"STUDY-119":7,"STUDY-120":2,"STUDY-121":5,"STUDY-122":6,"STUDY-123":1},F=100;let b,f;const V=document.getElementById("ratingsChart").getContext("2d");b=new Chart(V,{type:"bar",data:{labels:r,datasets:[{label:"Average Rating",data:[],backgroundColor:"rgba(102, 126, 234, 0.8)",borderColor:"rgba(102, 126, 234, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:5,title:{display:!0,text:"Rating (1-5)"}}}}});const z=document.getElementById("agreementChart").getContext("2d");f=new Chart(z,{type:"bar",data:{labels:r,datasets:[{label:"Standard Deviation",data:[],backgroundColor:"rgba(118, 75, 162, 0.8)",borderColor:"rgba(118, 75, 162, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Std Deviation (lower = higher agreement)"}}}}});function Q(t){if(!t||t.length===0)return{mean:0,stdDev:0,min:0,max:0,agreement:0};const e=t.reduce((c,u)=>c+u,0)/t.length,n=t.reduce((c,u)=>c+Math.pow(u-e,2),0)/t.length,i=Math.sqrt(n),d=Math.min(...t),l=Math.max(...t),p=e===0?0:Math.min(100,100*(1-i/e));return{mean:e.toFixed(2),stdDev:i.toFixed(2),min:d.toFixed(1),max:l.toFixed(1),agreement:p.toFixed(0)}}function E(t,e,n){const i={};let d=0,l=[];r.forEach(a=>{const o=t[a]||{},s=Object.values(o).filter(g=>g!=null).map(g=>g.rating||g),C=M[a]||4,I=[...s,...Array(F).fill(C)];i[a]={...Q(I),count:s.length,totalCount:I.length},d+=s.length}),document.getElementById("totalRatings").textContent=d;const p=e?Object.keys(e).filter(a=>{const o=e[a].timestamp;return Date.now()-o<6e4}).length:0;document.getElementById("activeParticipants").textContent=p;const c=n?Object.keys(n).length:0;if(document.getElementById("completedSessions").textContent=c,n){l=Object.values(n).map(o=>o.score||0);const a=l.length>0?(l.reduce((o,s)=>o+s,0)/l.length).toFixed(0):0;document.getElementById("avgScore").textContent=a}b.data.datasets[0].data=r.map(a=>i[a].mean),b.update(),f.data.datasets[0].data=r.map(a=>i[a].stdDev),f.update();const u=document.getElementById("statsTableBody");u.innerHTML=r.map(a=>{const o=i[a],s=L[a];return`
                    <tr>
                        <td><strong>${a}</strong></td>
                        <td>
                            <span class="quality-indicator ${s==="high"?"quality-high":s==="medium"?"quality-medium":"quality-low"}"></span>
                            ${s.charAt(0).toUpperCase()+s.slice(1)}
                        </td>
                        <td>${o.count}</td>
                        <td>${o.mean}</td>
                        <td>${o.stdDev}</td>
                        <td>${o.min}</td>
                        <td>${o.max}</td>
                        <td>${o.agreement}%</td>
                    </tr>
                `}).join("")}let y={},S={},T={};w(h(U,"ratings"),t=>{y=t.val()||{},E(y,S,T)});w(h(U,"active"),t=>{S=t.val()||{},E(y,S,T)});w(h(U,"leaderboard"),t=>{T=t.val()||{},E(y,S,T)});let D,m=10,Y=null;$(v,t=>{Y=t,t&&(document.getElementById("adminEmail").textContent=`✅ Signed in as ${t.email}`)});window.openAdminPanel=function(){document.getElementById("adminOverlay").classList.add("active"),Y?(document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block"):(document.getElementById("passwordSection").style.display="block",document.getElementById("adminActions").style.display="none",document.getElementById("adminEmail").value="",document.getElementById("adminPassword").value="",document.getElementById("adminEmail").focus(),W())};window.closeAdminPanel=function(t){(!t||t.target.id==="adminOverlay"||t.target.classList.contains("btn-cancel"))&&(document.getElementById("adminOverlay").classList.remove("active"),clearInterval(D),m=10)};function W(){m=10,x(),D=setInterval(()=>{m--,x(),m<=0&&(clearInterval(D),closeAdminPanel({target:{id:"adminOverlay"}}))},1e3)}function x(){const t=document.getElementById("adminTimer");t.textContent=`Time remaining: ${m}s`,m<=3?t.classList.add("warning"):t.classList.remove("warning")}window.handlePasswordKeyPress=function(t){t.key==="Enter"&&verifyPassword()};window.verifyPassword=function(){const t=document.getElementById("adminEmail").value.trim(),e=document.getElementById("adminPassword").value;if(!t||!e){alert("❌ Please enter both email and password");return}const n=document.getElementById("loginBtn");n.disabled=!0,n.textContent="Signing in...",q(v,t,e).then(i=>{clearInterval(D),Y=i.user,document.getElementById("passwordSection").style.display="none",document.getElementById("adminActions").style.display="block",document.getElementById("adminTitle").textContent="✅ Admin Panel",n.disabled=!1,n.textContent="Sign In"}).catch(i=>{let d="Authentication failed";i.code==="auth/invalid-credential"||i.code==="auth/wrong-password"||i.code==="auth/user-not-found"?d="Invalid email or password":i.code==="auth/too-many-requests"&&(d="Too many failed attempts. Try again later"),alert("❌ "+d),document.getElementById("adminPassword").value="",n.disabled=!1,n.textContent="Sign In"})};window.adminSignOut=function(){R(v).then(()=>{Y=null,closeAdminPanel({target:{id:"adminOverlay"}})}).catch(t=>{alert("❌ Error signing out: "+t.message)})};window.endAllSessions=function(){const t=Object.keys(S).length;if(t===0){alert("ℹ️ No active sessions to end");return}if(confirm(`⚠️ This will end ${t} active session(s).

Are you sure you want to continue?`)){const e=document.getElementById("endSessionsBtn");e.disabled=!0,e.textContent="Ending sessions...",P(h(U,"active"),null).then(()=>{alert(`✅ Successfully ended ${t} session(s)`),e.disabled=!1,e.textContent="⏹️ End All Active Sessions",closeAdminPanel({target:{id:"adminOverlay"}})}).catch(n=>{alert("❌ Error ending sessions: "+n.message),e.disabled=!1,e.textContent="⏹️ End All Active Sessions"})}};
