# App Structure Guide - Complete Flow

This document explains how all the pages are assembled and connected.

## ğŸ“„ Page Flow Overview

```
Page 1: Welcome
    â†“
Page 2: Glossary & Rubric
    â†“
Page 3-8: Paper Pages (6 papers)
    â†“
Page 9: Recap & Goodbye
```

## ğŸ—ï¸ How It's Built

### 1ï¸âƒ£ Page 1: Welcome (Static)
**Location:** `index.html` lines 11-33

**Content:**
- Workshop title and description
- How it works (3 steps)
- "Get Started" button â†’ navigates to Page 2

**Key Code:**
```html
<div class="page active" id="page-welcome">
    <button class="btn-primary" onclick="nextPage()">Get Started</button>
</div>
```

---

### 2ï¸âƒ£ Page 2: Glossary & Rubric (Dynamic Content)
**Location:** `index.html` lines 36-56

**Content Loaded From:**
- `glossary.json` â†’ 12 scientific terms
- `rubric.json` â†’ 6-category rating criteria

**JavaScript Functions:**
- `renderGlossary()` - Populates glossary from JSON
- `renderRubric()` - Creates rubric table from JSON

**Flow:**
```javascript
// app.js lines 62-104
async function loadContent() {
    glossary = await fetch('glossary.json').then(r => r.json());
    rubric = await fetch('rubric.json').then(r => r.json());
}

renderGlossary(); // Inserts into #glossary-content
renderRubric();   // Inserts into #rubric-content
```

---

### 3ï¸âƒ£ Pages 3-8: Paper Pages (Dynamically Generated)
**Generated By:** `generatePaperPages()` function in `app.js` lines 107-196

**Data Source:** `papers.json` (6 papers)

**Each Paper Page Contains:**

#### A. Paper Information Card
```javascript
<div class="paper-card">
    <div class="paper-id">STUDY-001</div>
    <h1 class="paper-title">${paper.headline}</h1>
    
    // 5 sections with icons:
    ğŸ“° Access
    ğŸ”¬ Study Overview
    ğŸ“Š Methods & Data
    ğŸ“ Conclusion
    ğŸ›ï¸ Source
</div>
```

#### B. Rating Interface
```javascript
<div class="rating-section">
    // Radio buttons 1-7
    [1] [2] [3] [4] [5] [6] [7]
    
    <button onclick="submitRating()">Submit Rating</button>
</div>
```

#### C. Results Display (Hidden Until Submission)
```javascript
<div class="results-box" style="display: none;">
    Your Rating: [X]
    Average Rating: [Y.Z]
    Based on N participants
    
    <button onclick="nextPage()">Next Paper</button>
</div>
```

**Generation Code:**
```javascript
papers.forEach((paper, index) => {
    const pageHTML = `<div class="page" id="page-paper-${index}">...</div>`;
    paperPagesContainer.innerHTML += pageHTML;
});
```

---

### 4ï¸âƒ£ Rating & Comparison System

#### Step 1: User Selects Rating
```javascript
// When user clicks a number 1-7
function enableSubmit(paperIndex) {
    document.getElementById(`submit-${paperIndex}`).disabled = false;
}
```

#### Step 2: Submit to Firebase
```javascript
// app.js lines 240-271
async function submitRating(paperIndex, paperId) {
    const rating = parseInt(selectedRating.value);
    
    // Save to Firebase
    const ratingRef = ref(database, `ratings/${paperId}/${sessionId}`);
    await set(ratingRef, {
        rating: rating,
        timestamp: Date.now()
    });
    
    // Hide rating form
    document.getElementById(`rating-section-${paperIndex}`).style.display = 'none';
    
    // Show results
    showResults(paperIndex, paperId, rating);
}
```

#### Step 3: Real-Time Average Calculation
```javascript
// app.js lines 273-301
function showResults(paperIndex, paperId, userRating) {
    // Display user's rating immediately
    document.getElementById(`your-rating-${paperIndex}`).textContent = userRating;
    
    // Listen for real-time updates from Firebase
    const ratingsRef = ref(database, `ratings/${paperId}`);
    onValue(ratingsRef, (snapshot) => {
        const ratings = snapshot.val();
        const ratingValues = Object.values(ratings).map(r => r.rating);
        
        // Calculate average
        const average = ratingValues.reduce((a, b) => a + b, 0) / ratingValues.length;
        const participantCount = ratingValues.length;
        
        // Update display
        document.getElementById(`avg-rating-${paperIndex}`).textContent = average.toFixed(1);
        document.getElementById(`count-${paperIndex}`).textContent = 
            `Based on ${participantCount} participant${participantCount !== 1 ? 's' : ''}`;
    });
}
```

**Firebase Data Structure:**
```
ratings/
  â”œâ”€ STUDY-001/
  â”‚   â”œâ”€ session_123_abc/
  â”‚   â”‚   â”œâ”€ rating: 6
  â”‚   â”‚   â””â”€ timestamp: 1738518123456
  â”‚   â”œâ”€ session_124_def/
  â”‚   â”‚   â”œâ”€ rating: 7
  â”‚   â”‚   â””â”€ timestamp: 1738518234567
  â”‚   â””â”€ session_125_ghi/
  â”‚       â”œâ”€ rating: 5
  â”‚       â””â”€ timestamp: 1738518345678
  â””â”€ STUDY-002/
      â””â”€ ...
```

---

### 5ï¸âƒ£ Page 9: Recap & Goodbye (Static)
**Location:** `index.html` lines 59-92

**Content:**
- Congratulations message
- Total papers evaluated (dynamically inserted)
- Key takeaways (4 points)
- Tips for future science reading

**Dynamic Element:**
```javascript
// app.js line 45 - Sets total papers count
document.getElementById('total-papers').textContent = papers.length;
```

---

## ğŸ¨ Visual Elements

### Floating Help Button
**Appears:** On paper pages only (pages 3-8)
**Function:** Opens modal with glossary & rubric

```javascript
// app.js lines 195-218
function showPage(pageIndex) {
    if (pageIndex <= papers.length + 1) {
        // Show help button on paper pages
        document.getElementById('help-button').classList.add('visible');
    } else {
        // Hide on other pages
        document.getElementById('help-button').classList.remove('visible');
    }
}
```

### Help Modal
**Structure:**
```html
<div id="help-modal" class="modal">
    <div class="modal-tabs">
        <button onclick="showTab('glossary')">Glossary</button>
        <button onclick="showTab('rubric')">Rating Rubric</button>
    </div>
    <div id="modal-glossary"></div>
    <div id="modal-rubric"></div>
</div>
```

---

## ğŸ”„ Page Navigation System

### Navigation Function
```javascript
// app.js lines 195-226
function showPage(pageIndex) {
    // Hide all pages
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    
    // Determine target page
    if (pageIndex === 0) {
        targetPage = document.getElementById('page-welcome');
    } else if (pageIndex === 1) {
        targetPage = document.getElementById('page-guide');
    } else if (pageIndex <= papers.length + 1) {
        targetPage = document.getElementById(`page-paper-${pageIndex - 2}`);
    } else {
        targetPage = document.getElementById('page-final');
    }
    
    // Show target page
    targetPage.classList.add('active');
    window.scrollTo(0, 0);
}

function nextPage() {
    if (currentPage < totalPages - 1) {
        showPage(currentPage + 1);
    }
}
```

### Page Index Mapping
```
Index 0 â†’ page-welcome
Index 1 â†’ page-guide
Index 2 â†’ page-paper-0 (STUDY-001)
Index 3 â†’ page-paper-1 (STUDY-002)
Index 4 â†’ page-paper-2 (STUDY-003)
Index 5 â†’ page-paper-3 (STUDY-004)
Index 6 â†’ page-paper-4 (STUDY-005)
Index 7 â†’ page-paper-5 (STUDY-006)
Index 8 â†’ page-final
```

---

## ğŸ¯ Complete User Journey

1. **User opens app** â†’ Page 1 (Welcome)
2. **Clicks "Get Started"** â†’ Page 2 (Glossary & Rubric)
3. **Clicks "Start Rating Papers"** â†’ Page 3 (First paper: STUDY-001)
4. **Reads paper info** â†’ 5 sections displayed
5. **Selects rating 1-7** â†’ Submit button activates
6. **Clicks Submit** â†’ Rating sent to Firebase
7. **Results display** â†’ Shows user's rating + real-time average
8. **Clicks "Next Paper"** â†’ Page 4 (STUDY-002)
9. **Repeats steps 4-8** for all 6 papers
10. **After last paper** â†’ Page 9 (Recap & Goodbye)

---

## ğŸ“± Interactive Features

### Real-Time Updates
- When ANY participant submits a rating
- Firebase triggers `onValue()` listener
- Average recalculates automatically
- All active users see updated average

### Responsive Design
- Mobile-first CSS (styles.css)
- Touch-friendly buttons (60px minimum)
- Readable text on small screens
- Optimized for portrait orientation

### Session Management
- Each user gets unique session ID
- Prevents duplicate ratings
- Tracks individual vs. collective ratings

---

## ğŸ§ª Testing the Complete Flow

### Local Testing:
```bash
npm run dev
# Open http://localhost:3000
```

### Multi-User Testing:
1. Open in Browser A â†’ Rate paper â†’ See your rating
2. Open in Browser B (incognito) â†’ Rate same paper
3. Check Browser A â†’ Average updates automatically!

### Production Testing:
```bash
npm run build
npm run preview
# Test the production build
```

---

## ğŸ“Š Data Flow Diagram

```
User Action          â†’  JavaScript          â†’  Firebase          â†’  All Users
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Select rating 1-7    â†’  enableSubmit()      â†’                    â†’
Click Submit         â†’  submitRating()      â†’  set(rating)       â†’
                     â†’  showResults()       â†’                    â†’
                     â†’  onValue(listen)     â†  snapshot          â†  Real-time update
Calculate average    â†  map/reduce          â†  all ratings       â†
Display to user      â†  textContent update  â†                    â†  Everyone sees
```

---

## âœ… Checklist: Is Everything Assembled?

- âœ… Page 1: Welcome message - **Static HTML**
- âœ… Page 2: Glossary & Rubric - **Dynamic from JSON**
- âœ… Pages 3-8: Paper pages - **Generated from papers.json**
- âœ… Rating interface per paper - **Radio buttons + Submit**
- âœ… Immediate comparison system - **Firebase real-time**
- âœ… Page 9: Recap & Goodbye - **Static HTML + dynamic count**
- âœ… Navigation system - **nextPage() function**
- âœ… Help modal - **Floating button + modal**
- âœ… Session tracking - **Unique session IDs**
- âœ… Responsive design - **Mobile-first CSS**

**Everything is assembled and ready to use!** ğŸ‰

Run `npm run dev` to see it in action!
